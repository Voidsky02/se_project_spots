!function(){"use strict";const e={modalSelector:".modal",formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};function n(e,t,r="Save",o="Saving..."){e.textContent=t?o:r}function a(e){e.classList.add("modal_opened"),document.addEventListener("keydown",c)}function s(e){e.classList.remove("modal_opened"),l()}const c=e=>{"Escape"===e.key&&s(document.querySelector(".modal_opened"))},l=()=>{document.removeEventListener("keydown",c)},i=document.querySelector("#edit-modal"),d=document.querySelector(".profile__edit-btn"),u=document.querySelector("#profile__close-btn");d.addEventListener("click",(()=>{var r,o;q.value=b.textContent,E.value=p.textContent,r=i,o=e,[q,E].forEach((e=>{t(r,e,o)})),a(i)})),u.addEventListener("click",(()=>{s(i)}));const m=document.querySelector("#new-post__modal"),_=document.querySelector(".profile__add-btn"),h=document.querySelector("#new-post__close-btn");_.addEventListener("click",(()=>{a(m)})),h.addEventListener("click",(()=>{s(m)}));const v=document.querySelector("#preview__modal"),y=document.querySelector(".modal__img_type_preview"),f=document.querySelector(".modal__title_type_preview");document.querySelector(".modal__close-btn_type_preview").addEventListener("click",(()=>{s(v)}));const S=document.querySelector(".profile__avatar"),b=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),q=document.querySelector("#name"),E=document.querySelector("#description");document.forms.profile__modal_form.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;n(t,!0),N.editUserInfo({name:q.value,about:E.value}).then((e=>{b.textContent=e.name,p.textContent=e.about,s(i)})).catch((e=>{console.error(e)})).finally((()=>{n(t,!1)}))}));const k=document.querySelector("#card-template"),L=document.querySelector(".cards__list");function g(e){const t=k.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__like-btn");r.addEventListener("click",(t=>{!function(e,t){const r=e.target.classList.contains("card__like-btn-selected");N.changeLikeStatus(t,r).then((()=>{e.target.classList.toggle("card__like-btn-selected")})).catch((e=>{console.error(e)}))}(t,e._id)})),!0===e.isLiked&&r.classList.add("card__like-btn-selected"),t.querySelector(".card__delete-btn").addEventListener("click",(()=>{!function(e,t){H=e,z=t,a($)}(t,e._id)}));const o=t.querySelector(".card__title"),n=t.querySelector(".card__image");return o.textContent=e.name,n.src=e.link,n.alt=e.name,n.addEventListener("click",(()=>{a(v),y.src=e.link,y.alt=e.name,f.textContent=e.name})),t}var C;document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("modal")&&s(e)}))})),C=e,document.querySelectorAll(C.formSelector).forEach((e=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach((s=>{s.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)}))}))})(e,C)}));const $=document.querySelector("#delete-modal"),j=$.querySelector("#delete__close-btn"),U=$.querySelector("#cancel-btn"),P=$.querySelector("#delete-form");j.addEventListener("click",(()=>{s($)})),U.addEventListener("click",(()=>{s($)})),P.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;n(t,!0,"Delete","Deleting..."),N.deleteCard(z).then((()=>{H.remove(),s($)})).catch((e=>{console.error(e)})).finally((()=>{n(t,!1,"Delete")}))}));const w=document.querySelector(".profile__avatar-btn"),x=document.querySelector("#avatar-modal"),A=x.querySelector(".modal__form"),D=x.querySelector(".modal__submit-btn"),I=x.querySelector("#profile-avatar-input"),T=x.querySelector("#avatar__close-btn");w.addEventListener("click",(()=>{a(x)})),T.addEventListener("click",(()=>{s(x)})),A.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter;n(r,!0),N.editAvatar(I.value).then((r=>{S.src=r.avatar,s(x),t.target.reset(),o(D,e)})).catch((e=>{console.error(e)})).finally((()=>{n(r,!1)}))}));const N=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addNewPost({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}changeLikeStatus(e,t){const r=t?"DELETE":"PUT";return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:r,headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"2614c96a-b56e-4551-baaa-15c592c84c27","Content-Type":"application/json"}});N.getAppInfo().then((([e,t])=>{e.forEach((e=>{const t=g(e);L.prepend(t)})),S.src=t.avatar,b.textContent=t.name,p.textContent=t.about})).catch((e=>{console.error(e)}));const B=m.querySelector(".modal__submit-btn"),O=document.querySelector("#image-link"),J=document.querySelector("#image-caption");let H,z;document.querySelector("#new-post__modal_form").addEventListener("submit",(function(t){t.preventDefault(),n(B,!0),N.addNewPost({name:`${J.value}`,link:`${O.value}`}).then((r=>{const n=g(r);L.prepend(n),s(m),t.target.reset(),o(B,e)})).catch((e=>{console.error(e)})).finally((()=>{n(B,!1)}))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTbEYsS0FDaENoQixFQUFnQnJDLFlBQWN1SSxFQUFTakYsS0FBSyxJQUU3Q0csT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxJQUt0QixNQUFNZ0YsRUFBZ0JuRyxFQUFhekMsY0FBYyxzQkFDM0M2SSxFQUFpQnRILFNBQVN2QixjQUFjLGVBQ3hDOEksRUFBb0J2SCxTQUFTdkIsY0FBYyxrQkE4QmpELElBQUkrRSxFQUNBQyxFQTlCcUJ6RCxTQUFTdkIsY0FBYyx5QkFFL0J3QixpQkFBaUIsVUFFbEMsU0FBNkJ5QixHQUMzQkEsRUFBTUMsaUJBQ05sQyxFQUFjNEgsR0FBZSxHQUU3QnZGLEVBQ0c2RSxXQUFXLENBQ1YzRSxLQUFNLEdBQUd1RixFQUFrQjFHLFFBQzNCa0QsS0FBTSxHQUFHdUQsRUFBZXpHLFVBRXpCcUIsTUFBTUMsSUFDTCxNQUFNcUYsRUFBYzdFLEVBQWVSLEdBQ25DTyxFQUFVMEUsUUFBUUksR0FDbEJySCxFQUFXZSxHQUNYUSxFQUFNdUIsT0FBT3dDLFFBQ2JuRyxFQUFjK0gsRUFBZXhKLEVBQVMsSUFFdkN1RSxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBRW5CRyxTQUFRLEtBQ1AvQyxFQUFjNEgsR0FBZSxFQUFNLEdBRXpDLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIC8vIGFkZGluZyBteSBvd24gbW9kYWwgc2VsZWN0b3JcbiAgbW9kYWxTZWxlY3RvcjogXCIubW9kYWxcIixcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWwucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoXG4gIGJ0bixcbiAgaXNMb2FkaW5nLFxuICBkZWZhdWx0VGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gIH0gZWxzZSB7XG4gICAgYnRuLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XG4gIH1cbn1cbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgZGlzYWJsZUJ1dHRvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcbmltcG9ydCB7IHNldEJ1dHRvblRleHQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuXG4vLyBmdW5jdGlvbiBmb3Igb3BlbmluZyBhbmQgY2xvc2luZyBtb2RhbHMgKFVuaXZlcnNhbClcbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBpc0tleUVzY2FwZSk7XG59XG5cbi8vIGFkZCB0aGlzIGZ1bmN0aW9uIHdoZXJldmVyIGkgbmVlZCB0byBjbG9zZSBtb2RhbHMgYWthIGNsb3NlICYgc3VibWl0IGJ1dHRvbnNcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgcmVtb3ZlRXNjYXBlS2V5RnVuYygpO1xufVxuXG5jb25zdCBpc0tleUVzY2FwZSA9IChldnQpID0+IHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBjdXJyZW50TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcbiAgICBjbG9zZU1vZGFsKGN1cnJlbnRNb2RhbCk7XG4gIH1cbn07XG5cbi8vIG1hZGUgcmVtb3ZpbmcgZXNjYXBlIGtleSBsaXN0ZW5lciBhIGZ1bmN0aW9uIGZvciBlYXNpZXIgcmV1c2FiaWxpdHlcbmNvbnN0IHJlbW92ZUVzY2FwZUtleUZ1bmMgPSAoKSA9PiB7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGlzS2V5RXNjYXBlKTtcbn07XG5cbi8vIGFwcGx5aW5nIHRvZ2dsZU1vZGFsIGZ1bmN0aW9uIHRvIGVkaXQtcHJvZmlsZSBidXR0b25zXG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgcHJvZmlsZUNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19jbG9zZS1idG5cIik7XG5cbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSB1c2VyTmFtZS50ZXh0Q29udGVudDtcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSB1c2VyRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0UHJvZmlsZU1vZGFsLFxuICAgIFtwcm9maWxlTmFtZUlucHV0LCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5wcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG4vLyBhcHBseWluZyB0b2dnbGVNb2RhbCBmdW5jdGlvbiB0byBuZXctcG9zdCBidXR0b25zXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0X19tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0X19jbG9zZS1idG5cIik7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxubmV3UG9zdENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG4vLyBhcHBseWluZyB0b2dnbGVNb2RhbCBmdW5jdGlvbiB0byBpbWFnZSBwcmV2aWV3IGJ1dHRvbnNcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlld19fbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltZ190eXBlX3ByZXZpZXdcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3RpdGxlX3R5cGVfcHJldmlld1wiKTtcbmNvbnN0IHByZXZpZXdDbG9zZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idG5fdHlwZV9wcmV2aWV3XCJcbik7XG5wcmV2aWV3Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbi8qIEpTIHNjb2RlIHRvIG1ha2UgcGxhY2Vob2xkZXJzIG9mIGVkaXQgcHJvZmlsZSBmb3JtIG1hdGNoIG5hbWUgYW5kIGRlc2NyaXB0aW9uXG5vZiBVc2VyIHByb2ZpbGUgdnZ2ICovXG5cbmNvbnN0IHVzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHVzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgdXNlckRlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgcHJvZmlsZU5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZXNjcmlwdGlvblwiKTtcblxuLyogTWFraW5nIHNhdmUgYnV0dG9uIG9mIGVkaXQgcHJvZmlsZSBtb2RhbCBmdW5jdGlvbmFsLCB1cGRhdGluZyB0aGUgdXNlcnMgcHJvZmlsZSBuYW1lIGFuZCBkZXNjcmlwdGlvbi5cbkFsc28gbWFraW5nIHN1cmUgdGhlIGNsb3NlIGJ1dHRvbiBkb2VzIG5vdCBzYXZlIHRoZSBlbnRlcmVkIGluZm9ybWF0aW9uIHZ2diAqL1xuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIC8vIENoYW5nZSB0ZXh0Q29udGVudCB0byBcIlNhdmluZy4uLlwiXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2ZW50LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICB1c2VyTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIC8vIGNoYW5nZSB0ZXh0Q29udGVudCBiYWNrIHRvIFwiU2F2ZVwiXG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufVxuXG5jb25zdCBwcm9maWxlTW9kYWxGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJwcm9maWxlX19tb2RhbF9mb3JtXCJdO1xuXG5wcm9maWxlTW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuXG4vKiBTd2l0Y2ggY2FyZHMgZnJvbSBoYXJkIGNvZGVkIEhUTUwgdG8gVGVtcGxhdGVzIHJlcHJvZHVjYWJsZSB3aXRoIEpTICovXG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkSWQ7XG4gIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuXG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSwgXCJEZWxldGVcIik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUxpa2UoZXZ0LCBpZCkge1xuICBjb25zdCBpc0xpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bi1zZWxlY3RlZFwiKTtcbiAgYXBpXG4gICAgLmNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG4tc2VsZWN0ZWRcIik7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICAvLyBMaWtlIEJ1dHRvbiBGdW5jdGlvbmFsaXR5XG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBoYW5kbGVMaWtlKGV2dCwgZGF0YS5faWQpO1xuICB9KTtcblxuICBpZiAoZGF0YS5pc0xpa2VkID09PSB0cnVlKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuLXNlbGVjdGVkXCIpO1xuICB9XG5cbiAgLy8gRGVsZXRlIENhcmQgYnV0dG9uIEZ1bmN0aW9uYWxpdHlcbiAgY29uc3QgY2FyZERlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcbiAgY2FyZERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKTtcbiAgfSk7XG5cbiAgLy8gZmlsbGluZyBjb250ZW50XG4gIGNvbnN0IGNhcmROYW1lID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcblxuICBjYXJkTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlLmFsdCA9IGRhdGEubmFtZTtcblxuICAvLyBBZGRpbmcgZXZlbnQgaGFuZGxlcnMgZm9yIHByZXZpZXcgb2YgcGljdHVyZXNcbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gICAgcHJldmlld01vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3TW9kYWxUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLyBiZWxvdyBpcyBjb2RlIGZvciBjbG9zaW5nIG1vZGFscyB3aGVuIGNsaWNraW5nIG91dHNpZGUgb2YgYXJlYVxuY29uc3QgbW9kYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxuLy8gbWFkZSBldmVudCAnbW91c2Vkb3duJyBiZWNhdXNlIG1vZGFsIHdvdWxkIGNsb3NlIHdoZW4gaGlnaGxpZ2h0aW5nIGlucHV0XG4vLyB0byBkZWxldGUgYnV0IHJlbGVhc2luZyB0aGUgbW91c2Ugb3ZlciB0aGUgZGFyayBtb2RhbCBzZWN0aW9uXG5jb25zdCBzZXRNb2RhbEV2ZW50TGlzdGVuZXJzID0gKG1vZGFsQXJyYXkpID0+IHtcbiAgbW9kYWxBcnJheS5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufTtcblxuc2V0TW9kYWxFdmVudExpc3RlbmVycyhtb2RhbExpc3QpO1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcblxuLy8gRGVsZXRlIG1vZGFsIGZ1bmN0aW9uYWxpdHlcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNkZWxldGVfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYW5jZWwtYnRuXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWZvcm1cIik7XG5cbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuZGVsZXRlTW9kYWxDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbi8vIEF2YXRhciBmb3JtIGVsZW1lbnRzXG5jb25zdCBlZGl0QXZhdGFyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcbmNvbnN0IGF2YXRhckxpbmtJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhdmF0YXJfX2Nsb3NlLWJ0blwiKTtcblxuLy8gQXZhdGFyIGZvcm0gc3VibWl0IGZ1bmN0aW9uXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgdHJ1ZSk7XG5cbiAgYXBpXG4gICAgLmVkaXRBdmF0YXIoYXZhdGFyTGlua0lucHV0LnZhbHVlKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICB1c2VyQXZhdGFyLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGF2YXRhclN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbi8vIEF2YXRhciBldmVudCBsaXN0ZW5lcnNcbmVkaXRBdmF0YXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuXG5hdmF0YXJNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuXG4vLyBJbml0aWFsaXplIGFwaVxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMjYxNGM5NmEtYjU2ZS00NTUxLWJhYWEtMTVjNTkyYzg0YzI3XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLy8gaW5pdGlhbCBtZXRob2RzIHRoYXQgcmVuZGVyIG9uIHBhZ2UgbG9hZFxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlckluZm9dKSA9PiB7XG4gICAgLy8gaGFuZGxlIGluaXRpYWwgY2FyZHNcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgLy8gaGFuZGxlIHVzZXIgaW5mb1xuICAgIHVzZXJBdmF0YXIuc3JjID0gdXNlckluZm8uYXZhdGFyO1xuICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICB1c2VyRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VySW5mby5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xuXG4vL1xuLy8gQWRkIG5ldyBQb3N0XG5jb25zdCBjYXJkU3VibWl0QnRuID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBpbWFnZUxpbmtJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGlua1wiKTtcbmNvbnN0IGltYWdlQ2FwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS1jYXB0aW9uXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3RfX21vZGFsX2Zvcm1cIik7XG5cbm5ld1Bvc3RNb2RhbEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQb3N0U3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlTmV3UG9zdFN1Ym1pdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBzZXRCdXR0b25UZXh0KGNhcmRTdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5hZGROZXdQb3N0KHtcbiAgICAgIG5hbWU6IGAke2ltYWdlQ2FwdGlvbklucHV0LnZhbHVlfWAsXG4gICAgICBsaW5rOiBgJHtpbWFnZUxpbmtJbnB1dC52YWx1ZX1gLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IG5ld1VzZXJQb3N0ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChuZXdVc2VyUG9zdCk7XG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgICBldmVudC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oY2FyZFN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoY2FyZFN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufVxuXG4vLyBEZWxldGUgUG9zdCBGdW5jdGlvbmFsaXR5IHcvIEFwaSBDbGFzc1xubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBpbXBsZW1lbnQgUE9TVCBjYXJkXG4gIGFkZE5ld1Bvc3QoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBlZGl0QXZhdGFyKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICBjb25zdCBtZXRob2QgPSBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCI7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIG90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsIm1vZGFsU2VsZWN0b3IiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJzZXRCdXR0b25UZXh0IiwiYnRuIiwiaXNMb2FkaW5nIiwiZGVmYXVsdFRleHQiLCJsb2FkaW5nVGV4dCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiaXNLZXlFc2NhcGUiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXNjYXBlS2V5RnVuYyIsImV2dCIsImtleSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJlZGl0UHJvZmlsZU1vZGFsIiwicHJvZmlsZUVkaXRCdG4iLCJwcm9maWxlQ2xvc2VCdG4iLCJyZXNldFZhbGlkYXRpb24iLCJwcm9maWxlTmFtZUlucHV0IiwidmFsdWUiLCJ1c2VyTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwidXNlckRlc2NyaXB0aW9uIiwiZm9yRWFjaCIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RCdG4iLCJuZXdQb3N0Q2xvc2VCdG4iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxJbWFnZSIsInByZXZpZXdNb2RhbFRpdGxlIiwidXNlckF2YXRhciIsImZvcm1zIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ0biIsInN1Ym1pdHRlciIsImFwaSIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsInRoZW4iLCJkYXRhIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5IiwiY2FyZFRlbXBsYXRlIiwiY2FyZHNMaXN0IiwiZ2V0Q2FyZEVsZW1lbnQiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkTGlrZUJ0biIsImlzTGlrZWQiLCJ0YXJnZXQiLCJjb250YWlucyIsImNoYW5nZUxpa2VTdGF0dXMiLCJ0b2dnbGUiLCJoYW5kbGVMaWtlIiwiX2lkIiwiY2FyZElkIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJkZWxldGVNb2RhbCIsImhhbmRsZURlbGV0ZUNhcmQiLCJjYXJkTmFtZSIsImNhcmRJbWFnZSIsInNyYyIsImxpbmsiLCJhbHQiLCJtb2RhbEFycmF5IiwicXVlcnlTZWxlY3RvckFsbCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImRlbGV0ZU1vZGFsQ2xvc2VCdG4iLCJkZWxldGVNb2RhbENhbmNlbEJ0biIsImRlbGV0ZUZvcm0iLCJkZWxldGVDYXJkIiwiZWRpdEF2YXRhckJ0biIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhclN1Ym1pdEJ0biIsImF2YXRhckxpbmtJbnB1dCIsImF2YXRhck1vZGFsQ2xvc2VCdG4iLCJzdWJtaXRCdXR0b24iLCJlZGl0QXZhdGFyIiwiYXZhdGFyIiwicmVzZXQiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJhZGROZXdQb3N0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJ1c2VySW5mbyIsImNhcmQiLCJwcmVwZW5kIiwiY2FyZFN1Ym1pdEJ0biIsImltYWdlTGlua0lucHV0IiwiaW1hZ2VDYXB0aW9uSW5wdXQiLCJuZXdVc2VyUG9zdCJdLCJzb3VyY2VSb290IjoiIn0=